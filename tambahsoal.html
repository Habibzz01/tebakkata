<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kelola Soal - Game Tebak Kata</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <script src="dbs.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <nav class="nav">
                <div class="logo">Game Tebak Kata</div>
                <div class="nav-links">
                    <a href="dashboard.html">Dashboard</a>
                    <a href="index.html">Beranda</a>
                    <button class="theme-toggle" onclick="toggleTheme()">🌙</button>
                    <button class="btn btn-error" onclick="logout()">Logout</button>
                </div>
            </nav>
        </div>

        <div class="manage-questions">
            <div class="card animate-fadeIn" style="margin-bottom: 2rem;">
                <h2 style="margin-bottom: 2rem; color: var(--primary-color);">Tambah Soal Baru</h2>
                
                <form id="addQuestionForm">
                    <div class="form-group">
                        <label class="form-label">Kata</label>
                        <input type="text" class="form-input" id="word" required placeholder="Masukkan kata yang akan ditebak">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Hint</label>
                        <textarea class="form-input" id="hint" required placeholder="Masukkan hint/petunjuk" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Kategori</label>
                        <select class="form-input" id="category" required>
                            <option value="">Pilih kategori</option>
                            <option value="hewan">Hewan</option>
                            <option value="buah">Buah</option>
                            <option value="kendaraan">Kendaraan</option>
                            <option value="elektronik">Elektronik</option>
                            <option value="makanan">Makanan</option>
                            <option value="olahraga">Olahraga</option>
                            <option value="lainnya">Lainnya</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Tingkat Kesulitan</label>
                        <select class="form-input" id="difficulty" required>
                            <option value="">Pilih tingkat kesulitan</option>
                            <option value="mudah">Mudah</option>
                            <option value="sedang">Sedang</option>
                            <option value="sulit">Sulit</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Tambah Soal</button>
                </form>
            </div>

            <div class="card animate-fadeIn">
                <h2 style="margin-bottom: 2rem; color: var(--primary-color);">Daftar Soal</h2>
                
                <div style="margin-bottom: 1rem;">
                    <input type="text" class="form-input" id="searchQuestion" placeholder="Cari soal..." onkeyup="searchQuestions()">
                </div>
                
                <div id="questionsList">
                    <div class="spinner" style="margin: 2rem auto;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
        <div class="card" style="max-width: 500px; margin: 5% auto; position: relative;">
            <h3 style="margin-bottom: 1rem; color: var(--primary-color);">Edit Soal</h3>
            
            <form id="editQuestionForm">
                <div class="form-group">
                    <label class="form-label">Kata</label>
                    <input type="text" class="form-input" id="editWord" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Hint</label>
                    <textarea class="form-input" id="editHint" required rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Kategori</label>
                    <select class="form-input" id="editCategory" required>
                        <option value="hewan">Hewan</option>
                        <option value="buah">Buah</option>
                        <option value="kendaraan">Kendaraan</option>
                        <option value="elektronik">Elektronik</option>
                        <option value="makanan">Makanan</option>
                        <option value="olahraga">Olahraga</option>
                        <option value="lainnya">Lainnya</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Tingkat Kesulitan</label>
                    <select class="form-input" id="editDifficulty" required>
                        <option value="mudah">Mudah</option>
                        <option value="sedang">Sedang</option>
                        <option value="sulit">Sulit</option>
                    </select>
                </div>
                
                <div style="display: flex; gap: 1rem;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Update</button>
                    <button type="button" class="btn btn-secondary" style="flex: 1;" onclick="closeEditModal()">Batal</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let currentEditId = null;
        let allQuestions = [];

        // Theme Toggle
        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            const themeToggle = document.querySelector('.theme-toggle');
            themeToggle.textContent = newTheme === 'dark' ? '☀️' : '🌙';
        }

        // Load saved theme
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.setAttribute('data-theme', savedTheme);
            const themeToggle = document.querySelector('.theme-toggle');
            themeToggle.textContent = savedTheme === 'dark' ? '☀️' : '🌙';
            
            // Check authentication
            auth.onAuthStateChanged(function(user) {
                if (user) {
                    loadQuestions();
                } else {
                    window.location.href = 'login.html';
                }
            });
        });

        // Load questions
        function loadQuestions() {
            database.ref('questions').once('value')
                .then((snapshot) => {
                    allQuestions = [];
                    const questionsList = document.getElementById('questionsList');
                    questionsList.innerHTML = '';
                    
                    snapshot.forEach((childSnapshot) => {
                        const question = {
                            id: childSnapshot.key,
                            ...childSnapshot.val()
                        };
                        allQuestions.push(question);
                    });
                    
                    displayQuestions(allQuestions);
                });
        }

        // Display questions
        function displayQuestions(questions) {
            const questionsList = document.getElementById('questionsList');
            
            if (questions.length === 0) {
                questionsList.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">Belum ada soal</p>';
                return;
            }
            
            questions.forEach((question) => {
                const item = document.createElement('div');
                item.className = 'card';
                item.style.marginBottom = '1rem';
                item.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <h4 style="color: var(--primary-color); margin-bottom: 0.5rem;">${question.word}</h4>
                            <p style="color: var(--text-secondary); margin-bottom: 0.5rem;">${question.hint}</p>
                            <div style="display: flex; gap: 1rem; font-size: 0.9rem;">
                                <span style="background: var(--primary-color); color: white; padding: 0.25rem 0.5rem; border-radius: 0.25rem;">${question.category}</span>
                                <span style="background: ${getDifficultyColor(question.difficulty)}; color: white; padding: 0.25rem 0.5rem; border-radius: 0.25rem;">${question.difficulty}</span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-secondary" onclick="editQuestion('${question.id}')" style="padding: 0.5rem;">✏️</button>
                            <button class="btn btn-error" onclick="deleteQuestion('${question.id}')" style="padding: 0.5rem;">🗑️</button>
                        </div>
                    </div>
                `;
                questionsList.appendChild(item);
            });
        }

        // Get difficulty color
        function getDifficultyColor(difficulty) {
            switch(difficulty) {
                case 'mudah': return 'var(--success-color)';
                case 'sedang': return 'var(--warning-color)';
                case 'sulit': return 'var(--error-color)';
                default: return 'var(--text-secondary)';
            }
        }

        // Search questions
        function searchQuestions() {
            const searchTerm = document.getElementById('searchQuestion').value.toLowerCase();
            const filteredQuestions = allQuestions.filter(question => 
                question.word.toLowerCase().includes(searchTerm) ||
                question.hint.toLowerCase().includes(searchTerm) ||
                question.category.toLowerCase().includes(searchTerm)
            );
            displayQuestions(filteredQuestions);
        }

        // Add question form submission
        document.getElementById('addQuestionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const word = document.getElementById('word').value;
            const hint = document.getElementById('hint').value;
            const category = document.getElementById('category').value;
            const difficulty = document.getElementById('difficulty').value;
            
            const newQuestion = {
                word: word,
                hint: hint,
                category: category,
                difficulty: difficulty,
                createdAt: new Date().toISOString(),
                createdBy: auth.currentUser.uid
            };
            
            database.ref('questions').push(newQuestion)
                .then(() => {
                    showToast('Soal berhasil ditambahkan!', 'success');
                    document.getElementById('addQuestionForm').reset();
                    loadQuestions();
                })
                .catch((error) => {
                    showToast('Error: ' + error.message, 'error');
                });
        });

        // Edit question
        function editQuestion(questionId) {
            const question = allQuestions.find(q => q.id === questionId);
            if (question) {
                currentEditId = questionId;
                document.getElementById('editWord').value = question.word;
                document.getElementById('editHint').value = question.hint;
                document.getElementById('editCategory').value = question.category;
                document.getElementById('editDifficulty').value = question.difficulty;
                document.getElementById('editModal').style.display = 'block';
            }
        }

        // Edit question form submission
        document.getElementById('editQuestionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const word = document.getElementById('editWord').value;
            const hint = document.getElementById('editHint').value;
            const category = document.getElementById('editCategory').value;
            const difficulty = document.getElementById('editDifficulty').value;
            
            database.ref('questions/' + currentEditId).update({
                word: word,
                hint: hint,
                category: category,
                difficulty: difficulty,
                updatedAt: new Date().toISOString()
            })
            .then(() => {
                showToast('Soal berhasil diperbarui!', 'success');
                closeEditModal();
                loadQuestions();
            })
            .catch((error) => {
                showToast('Error: ' + error.message, 'error');
            });
        });

        // Close edit modal
        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            currentEditId = null;
        }

        // Delete question
        function deleteQuestion(questionId) {
            if (confirm('Apakah Anda yakin ingin menghapus soal ini?')) {
                database.ref('questions/' + questionId).remove()
                    .then(() => {
                        showToast('Soal berhasil dihapus!', 'success');
                        loadQuestions();
                    })
                    .catch((error) => {
                        showToast('Error: ' + error.message, 'error');
                    });
            }
        }

        // Logout function
        function logout() {
            auth.signOut()
                .then(() => {
                    showToast('Logout berhasil!', 'success');
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 1000);
                })
                .catch((error) => {
                    showToast('Error: ' + error.message, 'error');
                });
        }

        // Toast notification function
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 3000);
        }
    </script>
</body>
</html>